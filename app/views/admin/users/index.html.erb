<% content_for :title, "Danh sách người dùng" %>
<div class="card">
      <div class="card-header">
        <h3>Danh sách người dùng</h3>
      </div>
      <div class="card-body mx-2">
        <div class="row justify-content-end mb-2">
          <div class="col-md-6">
            <%= form_with url: admin_users_path, method: :get, class: "d-flex" do |form| %>
              <div class="input-group">
                <%= form.text_field :key_work, value: params[:key_work], class: 'form-control shadow-none', placeholder: 'Search', aria: { label: 'Search' } %>
                <button class="btn btn-primary px-4" type="submit">
                  <i class="fa fa-search"></i>
                </button>
              </div>
            <% end %>
          </div>
        </div>

        <div class="d-flex flex-row-reverse my-3">
          <%= link_to "Tạo mới", new_admin_poll_path(), class: "p-1 btn btn-primary ms-2" %>
          <%= link_to 'Export CSV', admin_users_path(format: :csv), class: "btn btn-primary ms-2" %>
          <div data-controller="user--import">
            <%= form_with url: import_admin_users_path, method: :post, local: true, data: { "user--import-target": "form" }, html: { multipart: true, id: "import-form" } do |f| %>
              <%= f.file_field :file, class: "d-none", id: "csv-file-input", data: { "user--import-target": "fileInput", action: "change->user--import#submitForm" } %>
              <button type="button" class="btn btn-primary" id="import-btn" data-action="click->user--import#triggerFileSelect">
                Import CSV
              </button>
            <% end %>
          </div>
        </div>
        <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Email</th>
                <th scope="col">User Name</th>
                <th scope="col">Avatar</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              <% @users.each do |user| %>
                  <tr>
                      <td><%= user.id - 1 %></td>
                      <td><%= user.email %></td>
                      <td><%= user.user_name %></td>
                      <td><%= image_tag user.avatar.variant(resize_to_limit: [100, 100])  if user.avatar.attached? %></td>
                      <td>
                        <%= link_to edit_admin_user_path(user), class: "btn btn-primary btn-sm" do %>
                          <%= icon('fa', 'pen')%>
                        <% end %>
                        <%= button_to admin_user_path(user), method: :delete, data: { turbo_confirm: "Are you sure?" }, form: { class: 'd-inline-block' }, class: "btn btn-danger btn-sm" do %>
                          <%= icon('fa', 'trash')%>
                        <% end %>
                      </td>
                  </tr>
              <% end %>
            </tbody>
            
          </table>
          <%= paginate @users, params: request.query_parameters, param_name: :page, url: admin_users_path %>
      </div>
    </div>