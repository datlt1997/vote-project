<div class='card'>
  <div class='card-header'>
    <h4><%= actionText %></h4>
  </div>
  <div class='card-body'>
    <% if @poll.errors.any? %>
      <div class="alert alert-danger">
        <h4>Errors:</h4>
        <ul>
          <% @poll.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with(model: [:admin, @poll], local: true, html: { multipart: true }) do |form| %>
      <div class="mb-3 form-group">
        <%= form.label :title, class: 'form-label' %>
        <%= form.text_field :title, class: 'form-control' %>
      </div>

      <div class="mb-3 form-group">
        <%= form.label :description, class: 'form-label' %>
        <%= form.text_area :description, size: '50x10', class: 'form-control' %>
      </div>

      <div class="mb-3 form-check d-none">
        <%= form.label :allows_multiple, class: 'form-check-label' %>
        <%= form.check_box :allows_multiple, class: 'form-check-input' %>
      </div>

      <div class="mb-3 form-check">
        <%= form.label :anonymous, class: 'form-check-label' %>
        <%= form.check_box :anonymous, class: 'form-check-input' %>
      </div>

      <div class="mb-3 form-group">
        <%= form.label :image, class: 'form-label' %>

        <div data-controller="poll--image"
             data-poll--image-initial-url-value="<%= url_for(@poll.image) if @poll.image.attached? %>"
             class="ms-2 my-3 position-relative input-image-form"
             data-poll--image-target="container">

          <img src="<%= url_for(@poll.image) if @poll.image.attached? %>"
               id="poll-image-preview"
               class="img-thumbnail mb-2"
               style="max-width: 100px; max-height: 70px;"
               data-poll--image-target="preview"
               <%= "hidden" unless @poll.image.attached? %> >

          <button type="button"
                  class="btn-close position-absolute top-0 start-0 translate-middle translate-middle border border-1 rounded-circle"
                  data-action="poll--image#removeImage"
                  data-poll--image-target="removeBtn"
                  style="z-index: 10;"
                  <%= "hidden" unless @poll.image.attached? %>>
          </button>
          <%= form.hidden_field :remove_image, value: false, id: "remove-image-flag" %>

          <%= form.file_field :image,
                class: 'form-control d-none',
                id: 'poll-image-file',
                data: { "poll--image-target": "fileInput", action: "change->poll--image#preview" } %>

          <button type="button"
                  class="btn btn-secondary d-block"
                  data-action="click->poll--image#triggerFileDialog">
            Tải ảnh
          </button>
        </div>
      </div>
      <div class="mb-3 form-group">
        <%= form.label :expires_at, class: 'form-label' %>
        <%= form.datetime_local_field  :expires_at, class: 'form-control' %>
      </div>

      <h6>Options</h6>
      <div data-controller="poll--option">
        <div id="options" data-poll--option-target="container">
          <%= form.fields_for :options do |option_form| %>
              <div class="nested-fields mb-2" >
                <%= option_form.hidden_field :_destroy %>
                <div class="input-group">
                  <%= option_form.text_field :content, class: 'form-control', placeholder: 'Thêm lựa chọn' %>
                  <div class="input-group-append">
                    <button class="btn position-absolute end-0 remove_fields" type="button" data-action="click->poll--option#remove"><%= icon('fa', 'trash')%></button>
                  </div>
                </div>
              </div>
          <% end %>
        </div>

        <button type="button" class="btn btn-success" id="add-option-btn" data-action="click->poll--option#add"><%= icon('fa', 'plus')%></button>
      </div>
      
      <br><br>

      <div class='text-center'>
        <%= form.submit actionText, class: 'btn btn-primary' %>
      </div>
    <% end %>
  </div>
</div>

